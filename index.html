<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Baumentwicklung Monitoring f√ºr Agroforst">
    <meta name="theme-color" content="#2e7d32">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>Baumentwicklung Monitor</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üå≥ Baumentwicklung</h1>
            <p class="subtitle">Agroforst Monitoring</p>
        </header>

        <div class="status-bar">
            <span id="onlineStatus" class="online">‚óè</span>
            <span id="savedCount">0 B√§ume gespeichert</span>
        </div>

        <!-- Startseite -->
        <div id="welcomeScreen" class="welcome-screen">
            <div class="welcome-content">
                <div class="project-info">
                    <h2>üåæ √úber agroforst-monitoring</h2>
                    <p>Diese App ist Teil des <strong>agroforst-monitoring</strong>, einem b√ºrgerwissenschaftlichen Forschungsnetzwerk zur Langzeit-Erforschung moderner Agroforst-√ñkosysteme ‚Äì landwirtschaftlich genutzte Fl√§chen, auf denen B√§ume mit Acker, Wiese oder Weide kombiniert werden.</p>
                    <p>Ziel ist es, √ºber viele Jahre √∂kologische und √∂konomie-bezogene Ver√§nderungen dieser Systeme zu beobachten und Daten √ºber Boden, Pflanzen, Tiere und Baumwachstum zu sammeln.</p>
                    <p>
                        <a href="https://agroforst-monitoring.de/" target="_blank" rel="noopener noreferrer" class="project-link">
                            üåê Mehr Infos auf agroforst-monitoring.de
                        </a>
                    </p>
                </div>

                <h2>üì± App Installation</h2>
                
                <div class="install-section">
                    <h3>ü§ñ Android</h3>
                    <ol>
                        <li>√ñffne diese Seite in Chrome</li>
                        <li>Tippe auf das Men√º (‚ãÆ) oben rechts</li>
                        <li>W√§hle "Zum Startbildschirm hinzuf√ºgen"</li>
                        <li>Best√§tige mit "Hinzuf√ºgen"</li>
                    </ol>
                </div>

                <div class="install-section">
                    <h3>üçé iOS (iPhone/iPad)</h3>
                    <ol>
                        <li>√ñffne diese Seite in Safari</li>
                        <li>Tippe auf das Teilen-Symbol (
                            <svg style="width:16px;height:16px;display:inline-block;vertical-align:middle;" viewBox="0 0 50 50">
                                <path fill="currentColor" d="M30.3 13.7L25 8.4l-5.3 5.3-1.4-1.4L25 5.6l6.7 6.7z"/>
                                <path fill="currentColor" d="M24 7h2v21h-2z"/>
                                <path fill="currentColor" d="M35 40H15c-1.7 0-3-1.3-3-3V19c0-1.7 1.3-3 3-3h7v2h-7c-.6 0-1 .4-1 1v18c0 .6.4 1 1 1h20c.6 0 1-.4 1-1V19c0-.6-.4-1-1-1h-7v-2h7c1.7 0 3 1.3 3 3v18c0 1.7-1.3 3-3 3z"/>
                            </svg>
                        )</li>
                        <li>Scrolle nach unten und w√§hle "Zum Home-Bildschirm"</li>
                        <li>Best√§tige mit "Hinzuf√ºgen"</li>
                    </ol>
                </div>

                <div class="install-note">
                    <p>üí° Nach der Installation kannst du die App offline nutzen!</p>
                </div>

                <button id="startNewRecordBtn" class="btn btn-primary btn-large">üå≥ Neue Erfassung starten</button>
            </div>
        </div>

        <div class="action-buttons">
            <button id="exportBtn" class="btn btn-secondary">üíæ CSV Export</button>
            <button id="viewDataBtn" class="btn btn-secondary">üìä Daten ansehen</button>
            <button id="backToWelcomeBtn" class="btn btn-secondary" style="display:none;">‚Üê Zur√ºck zur Startseite</button>
        </div>

        <form id="treeForm" style="display:none;">
            <!-- Seite 1: ID und Standort -->
            <section class="form-section">
                <h2>ID und Standort</h2>
                
                <div class="form-group">
                    <label for="name">Name der durchf√ºhrenden Person(en) *</label>
                    <input type="text" id="name" name="name" required>
                </div>

                <div class="form-group">
                    <label for="baumart">Untersuchte Baumart *</label>
                    <input type="text" id="baumart" name="baumart" list="baumartList" required>
                    <datalist id="baumartList">
                        <option value="Obst">
                        <option value="Kirsche">
                        <option value="Walnuss">
                        <option value="Birne">
                        <option value="Sorbus/Wertholz">
                        <option value="Speierling">
                        <option value="Elsbeere">
                    </datalist>
                </div>

                <div class="form-group">
                    <label for="baumId">
                        Baum-ID (z.B. "LRO-B-9") *
                        <button type="button" class="help-btn" onclick="showHelp('baumId')">?</button>
                    </label>
                    <input type="text" id="baumId" name="baumId" placeholder="LRO-B-9" required pattern="[A-Z]+-[A-Z]+-[0-9]+(\.[0-9]+)?">
                    <small>Format: Lokalgruppe-Reihe-Nummer (z.B. LRO-B-9 oder DA-C-2.1)</small>
                </div>

                <div class="form-group">
                    <label>Position</label>
                    <button type="button" id="getLocationBtn" class="btn btn-secondary">üìç GPS Position erfassen</button>
                    <div id="locationDisplay" class="location-info"></div>
                    <input type="hidden" id="latitude" name="latitude">
                    <input type="hidden" id="longitude" name="longitude">
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_s2">Erg√§nzungen/Problembeschreibungen</label>
                    <textarea id="ergaenzungen_s2" name="ergaenzungen_s2" rows="3"></textarea>
                </div>
            </section>

            <!-- Seite 2: Wuchsh√∂he -->
            <section class="form-section">
                <h2>
                    Wuchsh√∂he
                    <button type="button" class="help-btn" onclick="showHelp('wuchshoehe')">?</button>
                </h2>
                
                <div class="form-group">
                    <label for="hoehe">H√∂he in cm *</label>
                    <input type="number" id="hoehe" name="hoehe" min="0" max="10000" required>
                    <small>Messung mit Zollstock, Teleskopstab oder F√∂rstnerdreieck</small>
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_s3">Erg√§nzungen/Problembeschreibungen</label>
                    <textarea id="ergaenzungen_s3" name="ergaenzungen_s3" rows="3"></textarea>
                </div>
            </section>

            <!-- Seite 3: Brusth√∂henumfang -->
            <section class="form-section">
                <h2>Brusth√∂henumfang (1,3m)</h2>
                
                <div class="form-group">
                    <label for="umfang">Umfang in mm (Standard)</label>
                    <input type="number" id="umfang" name="umfang" min="0" max="5000">
                    <small>Markierung bei 1,3 m am eigenen K√∂rper machen (z.B. mit Kreppband)</small>
                </div>

                <div class="form-group">
                    <label for="durchmesser">Durchmesser in mm (falls Umfang nicht m√∂glich)</label>
                    <input type="number" id="durchmesser" name="durchmesser" min="0" max="2000">
                    <small>Messung mit Zollstock, nur ausf√ºllen wenn Umfang nicht messbar</small>
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_s4">Erg√§nzungen/Problembeschreibungen</label>
                    <textarea id="ergaenzungen_s4" name="ergaenzungen_s4" rows="3"></textarea>
                </div>
            </section>

            <!-- Seite 4: Vitalit√§t -->
            <section class="form-section">
                <h2>
                    Einordnung der Vitalit√§t
                    <button type="button" class="help-btn" onclick="showHelp('trieblaenge')">?</button>
                </h2>
                
                <div class="form-group">
                    <label for="trieblaenge">Durchschnittliche L√§nge der einj√§hrigen Triebe in cm *</label>
                    <input type="number" id="trieblaenge" name="trieblaenge" min="0" max="500" required>
                    <small>Bei toten B√§umen 0 eintragen</small>
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_s5">Erg√§nzungen/Problembeschreibungen</label>
                    <textarea id="ergaenzungen_s5" name="ergaenzungen_s5" rows="3"></textarea>
                </div>
            </section>

            <!-- Seite 5: Statik und Stammqualit√§t -->
            <section class="form-section">
                <h2>Statik und Stammqualit√§t</h2>
                
                <div class="form-group">
                    <label for="neigung">
                        Neigung *
                        <button type="button" class="help-btn" onclick="showHelp('neigung')">?</button>
                    </label>
                    <select id="neigung" name="neigung" required>
                        <option value="">Bitte w√§hlen...</option>
                        <option value="Sehr geneigt (> 30¬∞ Neigung)">Sehr geneigt (> 30¬∞ Neigung)</option>
                        <option value="Leicht geneigt (> 10¬∞ Neigung)">Leicht geneigt (> 10¬∞ Neigung)</option>
                        <option value="Sehr gerade (< 10¬∞ Neigung)">Sehr gerade (< 10¬∞ Neigung)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="astungshoehe">√Ñstungsh√∂he in cm</label>
                    <input type="number" id="astungshoehe" name="astungshoehe" min="100" max="10000">
                    <small>Mindesth√∂he 100 cm, nur eintragen wenn klar erkennbar</small>
                </div>

                <div class="form-group">
                    <label for="erster_ast">Auf welcher H√∂he befindet sich der erste Ast mit mehr als 3 cm Durchmesser? (cm)</label>
                    <input type="number" id="erster_ast" name="erster_ast" min="0" max="10000">
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_s6">Erg√§nzungen/Problembeschreibungen</label>
                    <textarea id="ergaenzungen_s6" name="ergaenzungen_s6" rows="3" placeholder="z.B. Schl√§ngelwuchs, Drehung, Bogen im Stammverlauf"></textarea>
                </div>
            </section>

            <!-- Seite 6: Geh√∂lzschutz -->
            <section class="form-section">
                <h2>Geh√∂lzschutz</h2>
                
                <div class="form-group">
                    <label>Art des Geh√∂lzschutzes</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="schutz" value="kein_Gehoelzschutz"> kein Geh√∂lzschutz</label>
                        <label><input type="checkbox" name="schutz" value="Plastiknetz"> Plastiknetz</label>
                        <label><input type="checkbox" name="schutz" value="Plastikspirale"> Plastikspirale</label>
                        <label><input type="checkbox" name="schutz" value="Plastikroehre"> Plastikr√∂hre</label>
                        <label><input type="checkbox" name="schutz" value="unverzinktes_Metallgitter"> unverzinktes Metallgitter</label>
                        <label><input type="checkbox" name="schutz" value="verzinktes_Metallgitter"> verzinktes Metallgitter</label>
                        <label><input type="checkbox" name="schutz" value="andere"> andere</label>
                    </div>
                    <input type="text" id="schutz_andere" name="schutz_andere" placeholder="Beschreibung bei 'andere'" class="mt-1">
                </div>

                <div class="form-group">
                    <label for="schutz_zustand">Zustand des Geh√∂lzschutzes</label>
                    <select id="schutz_zustand" name="schutz_zustand">
                        <option value="">Bitte w√§hlen...</option>
                        <option value="nicht_vorhanden">nicht vorhanden</option>
                        <option value="nicht_intakt">nicht intakt / funktional</option>
                        <option value="beschaedigt_funktional">besch√§digt, aber funktional</option>
                        <option value="voll_intakt">voll intakt</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="stamm_geweisselt">Ist der Stamm gewei√üelt?</label>
                    <select id="stamm_geweisselt" name="stamm_geweisselt">
                        <option value="">Bitte w√§hlen...</option>
                        <option value="ja">ja</option>
                        <option value="nein">nein</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Wie ist der Baum angebunden?</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="anbindung" value="nicht_angebunden"> nicht angebunden</label>
                        <label><input type="checkbox" name="anbindung" value="angebunden_einschnuerend"> angebunden, aber einschn√ºrend</label>
                        <label><input type="checkbox" name="anbindung" value="angebunden_beweglich"> angebunden, aber zu beweglich</label>
                        <label><input type="checkbox" name="anbindung" value="gut_angebunden"> gut angebunden</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_s7">Erg√§nzungen/Problembeschreibungen</label>
                    <textarea id="ergaenzungen_s7" name="ergaenzungen_s7" rows="3"></textarea>
                </div>
            </section>

            <!-- Seite 7: Baumscheibe -->
            <section class="form-section">
                <h2>
                    Baumscheibe
                    <button type="button" class="help-btn" onclick="showHelp('baumscheibe')">?</button>
                </h2>
                
                <div class="form-group">
                    <label>Art des Managements</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="management" value="kein_Management"> kein bestimmtes Management erkennbar</label>
                        <label><input type="checkbox" name="management" value="freigehackt"> freigehackt, offner Boden</label>
                        <label><input type="checkbox" name="management" value="gemulcht_Hackschnitzel"> gemulcht mit Hackschnitzeln</label>
                        <label><input type="checkbox" name="management" value="gemulcht_Mist"> gemulcht mit Mist/Kompost</label>
                        <label><input type="checkbox" name="management" value="gemulcht_Grasschnitt"> gemulcht mit Grasschnitt</label>
                        <label><input type="checkbox" name="management" value="Baumscheibenvlies"> Baumscheibenvlies oder Jutestoff</label>
                        <label><input type="checkbox" name="management" value="andere"> andere</label>
                    </div>
                    <input type="text" id="management_andere" name="management_andere" placeholder="Beschreibung bei 'andere'" class="mt-1">
                </div>

                <div class="form-group">
                    <label>Zustand der Baumscheibe</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="baumscheibe_zustand" value="keine_Pflanzen"> keine oder kaum andere Pflanzen</label>
                        <label><input type="checkbox" name="baumscheibe_zustand" value="spaerlich"> sp√§rlich mit anderen Pflanzen bewachsen (&lt;50% Deckung)</label>
                        <label><input type="checkbox" name="baumscheibe_zustand" value="dicht"> dicht mit anderen Pflanzen bewachsen (>50% Deckung)</label>
                        <label><input type="checkbox" name="baumscheibe_zustand" value="klein"> Durchmesser der Baumscheibe &lt; 60 cm</label>
                        <label><input type="checkbox" name="baumscheibe_zustand" value="maeusegaenge"> M√§useg√§nge deutlich erkennbar</label>
                        <label><input type="checkbox" name="baumscheibe_zustand" value="wurzeln"> freiliegende Wurzeln</label>
                        <label><input type="checkbox" name="baumscheibe_zustand" value="weitere_Makel"> weitere Makel</label>
                    </div>
                    <input type="text" id="baumscheibe_makel" name="baumscheibe_makel" placeholder="Beschreibung weitere Makel" class="mt-1">
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_s8">Erg√§nzungen/Problembeschreibungen</label>
                    <textarea id="ergaenzungen_s8" name="ergaenzungen_s8" rows="3"></textarea>
                </div>
            </section>

            <!-- Seite 8: Sch√§den & Krankheiten -->
            <section class="form-section">
                <h2>Schnittwunden, Sch√§den & Krankheiten</h2>
                
                <div class="form-group">
                    <label for="schnittwunden">Anzahl offener Schnittwunden (> 3 cm)</label>
                    <input type="number" id="schnittwunden" name="schnittwunden" min="0" max="100" value="0">
                </div>

                <div class="form-group">
                    <label>Erfassung weiterer Sch√§den und Krankheiten</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="schaeden" value="verbissen"> verbissen (abgeschabte Rinde)</label>
                        <label><input type="checkbox" name="schaeden" value="verfeget"> verfeget (l√§nglich abgeschabte Rinde)</label>
                        <label><input type="checkbox" name="schaeden" value="pfosten_schaden"> Rindenschaden an Pfosten/Verbissschutz</label>
                        <label><input type="checkbox" name="schaeden" value="rindennekrose"> Rindennekrose (tote Rinde)</label>
                        <label><input type="checkbox" name="schaeden" value="pilzbefall"> Pilzbefall</label>
                        <label><input type="checkbox" name="schaeden" value="insekten"> Insektenbohrl√∂cher/-fra√üstellen</label>
                        <label><input type="checkbox" name="schaeden" value="frostrisse"> Frostrisse/Sonnenbrand</label>
                        <label><input type="checkbox" name="schaeden" value="abgebrochene_Spitze"> abgebrochene Spitze</label>
                        <label><input type="checkbox" name="schaeden" value="weitere"> weitere</label>
                    </div>
                    <input type="text" id="schaeden_weitere" name="schaeden_weitere" placeholder="Beschreibung weitere Sch√§den" class="mt-1">
                </div>

                <div class="form-group">
                    <label for="schaeden_beschreibung">Beschreibung der Sch√§den und Krankheiten</label>
                    <textarea id="schaeden_beschreibung" name="schaeden_beschreibung" rows="3" placeholder="z.B. Stamm oder √Ñste betroffen?"></textarea>
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_s9">Auff√§lligkeiten & Erg√§nzungen</label>
                    <textarea id="ergaenzungen_s9" name="ergaenzungen_s9" rows="3" placeholder="z.B. Vogelnest, Sortenschild, Nachpflanzung, untypisches Triebwachstum"></textarea>
                </div>
            </section>

            <!-- Seite 9: Fotodokumentation -->
            <section class="form-section">
                <h2>Fotodokumentation</h2>
                
                <div class="form-group">
                    <label for="foto">Foto von Auff√§lligkeiten</label>
                    <input type="file" id="foto" name="foto" accept="image/*" capture="environment" multiple>
                    <div id="photoPreview" class="photo-preview"></div>
                </div>
            </section>

            <div class="form-actions">
                <button type="button" id="saveFinishBtn" class="btn btn-primary">‚úì Speichern und abschlie√üen</button>
                <button type="button" id="saveNextTreeBtn" class="btn btn-primary">‚û°Ô∏è Speichern und n√§chster Baum</button>
                <button type="button" id="saveNextRowBtn" class="btn btn-primary">‚è© Speichern und n√§chste Reihe</button>
                <button type="button" id="resetBtn" class="btn btn-secondary">‚Üª Formular zur√ºcksetzen</button>
            </div>
        </form>

        <!-- Help Modals -->
        <div id="helpModal" class="modal">
            <div class="modal-content help-modal-content">
                <span class="close" onclick="closeHelp()">&times;</span>
                <div id="helpContent"></div>
            </div>
        </div>

        <!-- Data Modal -->
        <div id="dataModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Gespeicherte Baumdaten</h2>
                <div id="treeMap" class="tree-map-container">
                    <h3>Positionskarte</h3>
                    <canvas id="treeMapCanvas"></canvas>
                    <div id="mapLegend" class="map-legend"></div>
                </div>
                <div id="dataList"></div>
                <button id="clearAllBtn" class="btn btn-danger">Alle Daten l√∂schen</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>