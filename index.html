<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Baumentwicklung Monitoring f√ºr Agroforst">
    <meta name="theme-color" content="#2e7d32">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>Baumentwicklung Monitor</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üå≥ Baumentwicklung</h1>
            <p class="subtitle">agroforst-monitoring</p>
        </header>

        <div class="status-bar">
            <span id="onlineStatus" class="online">‚óè</span>
            <span id="savedCount">0 B√§ume gespeichert</span>
        </div>

        <div class="action-buttons">
            <button id="viewDataBtn" class="btn btn-secondary">üìä Daten ansehen oder zu einem gespeicherten Baum springen</button>
            <button id="backToWelcomeBtn" class="btn btn-secondary" style="display:none;">‚Üê Zur√ºck zur Startseite</button>
            <button id="backFromDataBtn" class="btn btn-secondary" style="display:none;">‚Üê Zur√ºck</button>
        </div>

        <!-- Startseite -->
        <div id="welcomeScreen" class="welcome-screen">
            <div class="welcome-content">
                <button id="startNewRecordBtn" class="btn btn-primary btn-large" style="margin-bottom: 2rem;">üå≥ Neue Erfassung starten</button>

                <div class="project-info">
                    <h2>üåæ √úber agroforst-monitoring</h2>
                    <p>Diese App ist Teil des <strong>agroforst-monitoring</strong>, einem b√ºrgerwissenschaftlichen Forschungsnetzwerk zur Langzeit-Erforschung moderner Agroforst-√ñkosysteme ‚Äì landwirtschaftlich genutzte Fl√§chen, auf denen B√§ume mit Acker, Wiese oder Weide kombiniert werden.</p>
                    <p>Ziel ist es, √ºber viele Jahre √∂kologische und √∂konomie-bezogene Ver√§nderungen dieser Systeme zu beobachten und Daten √ºber Boden, Pflanzen, Tiere und Baumwachstum zu sammeln.</p>
                    <p>
                        <a href="https://agroforst-monitoring.de/" target="_blank" rel="noopener noreferrer" class="project-link">
                            üåê Mehr Infos auf agroforst-monitoring.de
                        </a>
                    </p>
                </div>

                <div class="project-info" style="background: #fff3cd; border-left: 4px solid #ffc107;">
                    <h2>üì§ Wichtig: Daten√ºbermittlung</h2>
                    <p><strong>Diese App dient nur zur Datenerfassung vor Ort.</strong></p>
                    <p>Die erfassten Daten werden lokal auf Ihrem Ger√§t gespeichert. Um die Daten zu √ºbermitteln:</p>
                    <ol style="margin-left: 1.5rem; line-height: 1.8;">
                        <li>Erfassen Sie alle B√§ume mit der App</li>
                        <li>Exportieren Sie die Daten √ºber <strong>"üìä Daten ansehen"</strong> ‚Üí <strong>"üíæ CSV Export"</strong></li>
                        <li>Laden Sie die CSV-Datei im <strong>Uploadbereich Ihrer Lokalgruppe</strong> hoch (wie auch manuell erstellte Datentabellen)</li>
                    </ol>
                    <p style="margin-top: 1rem;"><em>üí° Tipp: Exportieren Sie regelm√§√üig ein Backup Ihrer Daten!</em></p>
                </div>

                <h2 style="margin-top: 2.5rem;">üì± App Installation</h2>
                
                <div class="install-section">
                    <h3>ü§ñ Android</h3>
                    <ol>
                        <li>√ñffne diese Seite in Chrome</li>
                        <li>Tippe auf das Men√º (‚ãÆ) oben rechts</li>
                        <li>W√§hle "Zum Startbildschirm hinzuf√ºgen"</li>
                        <li>Best√§tige mit "Hinzuf√ºgen"</li>
                    </ol>
                </div>

                <div class="install-section">
                    <h3>üçé iOS - Safari (empfohlen)</h3>
                    <ol>
                        <li>√ñffne diese Seite in Safari</li>
                        <li>Tippe auf das Teilen-Symbol (
                            <svg style="width:16px;height:16px;display:inline-block;vertical-align:middle;" viewBox="0 0 50 50">
                                <path fill="currentColor" d="M30.3 13.7L25 8.4l-5.3 5.3-1.4-1.4L25 5.6l6.7 6.7z"/>
                                <path fill="currentColor" d="M24 7h2v21h-2z"/>
                                <path fill="currentColor" d="M35 40H15c-1.7 0-3-1.3-3-3V19c0-1.7 1.3-3 3-3h7v2h-7c-.6 0-1 .4-1 1v18c0 .6.4 1 1 1h20c.6 0 1-.4 1-1V19c0-.6-.4-1-1-1h-7v-2h7c1.7 0 3 1.3 3 3v18c0 1.7-1.3 3-3 3z"/>
                            </svg>
                        )</li>
                        <li>Tippe auf "mehr" (oben im Teilen-Men√º) um nach unten scrollen zu k√∂nnen</li>
                        <li>Scrolle nach unten und w√§hle "Zum Home-Bildschirm"</li>
                        <li>Best√§tige mit "Hinzuf√ºgen"</li>
                    </ol>
                </div>

                <div class="install-section">
                    <h3>üçé iOS - Weitere Browser (Chrome, Firefox, etc.)</h3>
                    <ol>
                        <li>√ñffne diese Seite in deinem bevorzugten Browser (z.B. Chrome, Firefox)</li>
                        <li>Tippe auf das Teilen-Symbol</li>
                        <li>W√§hle "Zum Startbildschirm hinzuf√ºgen"</li>
                        <li>Best√§tige mit "Hinzuf√ºgen"</li>
                    </ol>
                </div>

                <div class="install-note">
                    <p>üí° Nach der Installation kannst du die App offline nutzen!</p>
                </div>

                
            </div>
        </div>

        <form id="treeForm" style="display:none;">
            <!-- Seite 1: ID und Standort -->
            <section class="form-section">
                <h2>ID und Standort</h2>
                
                <div class="form-group">
                    <label for="name">Name der durchf√ºhrenden Person(en) *</label>
                    <input type="text" id="name" name="name" required>
                </div>

                <div class="form-group">
                    <label for="baumart">Untersuchte Baumart *</label>
                    <input type="text" id="baumart" name="baumart" list="baumartList" required>
                    <datalist id="baumartList">
                        <option value="Obst">
                        <option value="Kirsche">
                        <option value="Walnuss">
                        <option value="Birne">
                        <option value="Sorbus/Wertholz">
                        <option value="Speierling">
                        <option value="Elsbeere">
                    </datalist>
                </div>

                <div class="form-group">
                    <label for="baumId">
                        Baum-ID (z.B. "LRO-B-09") *
                        <button type="button" class="help-btn" onclick="showHelp('baumId')">?</button>
                    </label>
                    <input type="text" id="baumId" name="baumId" placeholder="LRO-B-09" required pattern="[A-Z√Ñ√ñ√ú]+-[A-Z√Ñ√ñ√ú]+-[0-9]+(\.[0-9]+)?">
                    <small>Format: Lokalgruppe-Reihe-Nummer (z.B. LRO-B-09 oder DA-C-02.1)</small>
                </div>

                <div class="form-group">
                    <label>Position</label>
                    <button type="button" id="getLocationBtn" class="btn btn-secondary">üìç GPS Position erfassen</button>
                    <div id="locationDisplay" class="location-info"></div>
                    <input type="hidden" id="latitude" name="latitude">
                    <input type="hidden" id="longitude" name="longitude">
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_standort">Erg√§nzungen/Problembeschreibungen</label>
                    <textarea id="ergaenzungen_standort" name="ergaenzungen_standort" rows="3"></textarea>
                </div>
            </section>

            <!-- Seite 2: Wuchsh√∂he -->
            <section class="form-section">
                <h2>
                    Wuchsh√∂he
                    <button type="button" class="help-btn" onclick="showHelp('wuchshoehe')">?</button>
                </h2>
                
                <div class="form-group">
                    <label for="hoehe">H√∂he in cm *</label>
                    <input type="number" id="hoehe" name="hoehe" min="0" max="10000" required>
                    <small>Messung mit Zollstock, Teleskopstab oder F√∂rsterdreieck</small>
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_wuchshoehe">Erg√§nzungen/Problembeschreibungen</label>
                    <textarea id="ergaenzungen_wuchshoehe" name="ergaenzungen_wuchshoehe" rows="3"></textarea>
                </div>
            </section>

            <!-- Seite 3: Brusth√∂henumfang -->
            <section class="form-section">
                <h2>Brusth√∂henumfang (1,3 m)</h2>
                
                <div class="form-group">
                    <label for="umfang">Umfang in mm (Standard)</label>
                    <input type="number" id="umfang" name="umfang" min="0" max="5000">
                    <small>Markierung bei 1,3 m am eigenen K√∂rper machen (z.B. mit Kreppband)</small>
                </div>

                <div class="form-group">
                    <label for="durchmesser">Durchmesser in mm (falls Umfang nicht m√∂glich)</label>
                    <input type="number" id="durchmesser" name="durchmesser" min="0" max="2000">
                    <small>Messung mit Zollstock, nur ausf√ºllen wenn Umfang nicht messbar</small>
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_umfang">Erg√§nzungen/Problembeschreibungen</label>
                    <textarea id="ergaenzungen_umfang" name="ergaenzungen_umfang" rows="3"></textarea>
                </div>
            </section>

            <!-- Seite 4: Vitalit√§t -->
            <section class="form-section">
                <h2>
                    Einordnung der Vitalit√§t
                    <button type="button" class="help-btn" onclick="showHelp('trieblaenge')">?</button>
                </h2>
                
                <div class="form-group">
                    <label for="trieblaenge">Durchschnittliche L√§nge der einj√§hrigen Triebe in cm *</label>
                    <input type="number" id="trieblaenge" name="trieblaenge" min="-1" max="500" required>
                    <small>Wenn keine einj√§hrigen Triebe vorhanden: -1 eintragen. Bei toten B√§umen: 0 eintragen</small>
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_vitalitaet">Erg√§nzungen/Problembeschreibungen</label>
                    <textarea id="ergaenzungen_vitalitaet" name="ergaenzungen_vitalitaet" rows="3" placeholder="z.B. sch√ºtteres Laub, blasses/gelbes Laub, fr√ºhzeitiger Laubabwurf"></textarea>
                </div>
            </section>

            <!-- Seite 5: Statik und Stammqualit√§t -->
            <section class="form-section">
                <h2>Statik und Stammqualit√§t</h2>
                
                <div class="form-group">
                    <label for="neigung">
                        Neigung *
                        <button type="button" class="help-btn" onclick="showHelp('neigung')">?</button>
                    </label>
                    <select id="neigung" name="neigung" required>
                        <option value="">Bitte w√§hlen...</option>
                        <option value="Sehr geneigt (> 30¬∞ Neigung)">Sehr geneigt (> 30¬∞ Neigung)</option>
                        <option value="Leicht geneigt (> 10¬∞ Neigung)">Leicht geneigt (> 10¬∞ Neigung)</option>
                        <option value="Sehr gerade (< 10¬∞ Neigung)">Sehr gerade (< 10¬∞ Neigung)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="astungshoehe">√Ñstungsh√∂he in cm</label>
                    <input type="number" id="astungshoehe" name="astungshoehe" min="100" max="10000">
                    <small>Mindesth√∂he 100 cm, nur eintragen wenn klar erkennbar</small>
                </div>

                <div class="form-group">
                    <label for="kronenansatz">Kronenansatz: Auf welcher H√∂he befindet sich der erste Ast mit mehr als 3 cm Durchmesser? (cm)</label>
                    <input type="number" id="kronenansatz" name="kronenansatz" min="0" max="10000">
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_statik">Erg√§nzungen/Problembeschreibungen</label>
                    <textarea id="ergaenzungen_statik" name="ergaenzungen_statik" rows="3" placeholder="z.B. Schl√§ngelwuchs, Drehung, Bogen im Stammverlauf"></textarea>
                </div>
            </section>

            <!-- Seite 6: Geh√∂lzschutz -->
            <section class="form-section">
                <h2>Geh√∂lzschutz</h2>
                
                <div class="form-group">
                    <label>Art des Geh√∂lzschutzes</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="schutz" value="kein Geh√∂lzschutz"> kein Geh√∂lzschutz</label>
                        <label><input type="checkbox" name="schutz" value="Plastiknetz"> Plastiknetz</label>
                        <label><input type="checkbox" name="schutz" value="Plastikspirale"> Plastikspirale</label>
                        <label><input type="checkbox" name="schutz" value="Plastikr√∂hre"> Plastikr√∂hre</label>
                        <label><input type="checkbox" name="schutz" value="unverzinktes Metallgitter"> unverzinktes Metallgitter</label>
                        <label><input type="checkbox" name="schutz" value="verzinktes Metallgitter"> verzinktes Metallgitter</label>
                        <label><input type="checkbox" name="schutz" value="andere"> andere</label>
                    </div>
                    <input type="text" id="schutz_andere" name="schutz_andere" placeholder="Beschreibung bei 'andere'" class="mt-1">
                </div>

                <div class="form-group">
                    <label for="schutz_zustand">Zustand des Geh√∂lzschutzes</label>
                    <select id="schutz_zustand" name="schutz_zustand">
                        <option value="">Bitte w√§hlen...</option>
                        <option value="nicht vorhanden">nicht vorhanden</option>
                        <option value="nicht intakt">nicht intakt / funktional</option>
                        <option value="besch√§digt, aber funktional">besch√§digt, aber funktional</option>
                        <option value="voll intakt">voll intakt</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="stamm_geweisselt">Ist der Stamm gewei√üelt?</label>
                    <select id="stamm_geweisselt" name="stamm_geweisselt">
                        <option value="">Bitte w√§hlen...</option>
                        <option value="ja">ja</option>
                        <option value="nein">nein</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Wie ist der Baum angebunden?</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="anbindung" value="nicht angebunden"> nicht angebunden</label>
                        <label><input type="checkbox" name="anbindung" value="angebunden, aber einschn√ºrend"> angebunden, aber einschn√ºrend</label>
                        <label><input type="checkbox" name="anbindung" value="angebunden, aber zu beweglich"> angebunden, aber zu beweglich</label>
                        <label><input type="checkbox" name="anbindung" value="gut angebunden"> gut angebunden</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_gehoelzschutz">Erg√§nzungen/Problembeschreibungen</label>
                    <textarea id="ergaenzungen_gehoelzschutz" name="ergaenzungen_gehoelzschutz" rows="3"></textarea>
                </div>
            </section>

            <!-- Seite 7: Baumscheibe -->
            <section class="form-section">
                <h2>
                    Baumscheibe
                    <button type="button" class="help-btn" onclick="showHelp('baumscheibe')">?</button>
                </h2>
                
                <div class="form-group">
                    <label>Art des Managements</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="management" value="kein Management"> kein bestimmtes Management erkennbar</label>
                        <label><input type="checkbox" name="management" value="freigehackt"> freigehackt, offener Boden</label>
                        <label><input type="checkbox" name="management" value="gemulcht Hackschnitzel"> gemulcht mit Hackschnitzeln</label>
                        <label><input type="checkbox" name="management" value="gemulcht Mist"> gemulcht mit Mist/Kompost</label>
                        <label><input type="checkbox" name="management" value="gemulcht Grasschnitt"> gemulcht mit Grasschnitt</label>
                        <label><input type="checkbox" name="management" value="Baumscheibenvlies"> Baumscheibenvlies oder Jutestoff</label>
                        <label><input type="checkbox" name="management" value="andere"> andere</label>
                    </div>
                    <input type="text" id="management_andere" name="management_andere" placeholder="Beschreibung bei 'andere'" class="mt-1">
                </div>

                <div class="form-group">
                    <label>Zustand der Baumscheibe</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="baumscheibe_zustand" value="keine Pflanzen"> keine oder kaum andere Pflanzen</label>
                        <label><input type="checkbox" name="baumscheibe_zustand" value="sp√§rlich"> sp√§rlich mit anderen Pflanzen bewachsen (<50% Deckung)</label>
                        <label><input type="checkbox" name="baumscheibe_zustand" value="dicht"> dicht mit anderen Pflanzen bewachsen (>50% Deckung)</label>
                        <label><input type="checkbox" name="baumscheibe_zustand" value="klein"> Durchmesser der Baumscheibe < 60 cm</label>
                        <label><input type="checkbox" name="baumscheibe_zustand" value="M√§useg√§nge"> M√§useg√§nge deutlich erkennbar</label>
                        <label><input type="checkbox" name="baumscheibe_zustand" value="wurzeln"> freiliegende Wurzeln</label>
                        <label><input type="checkbox" name="baumscheibe_zustand" value="weitere Makel"> weitere Makel</label>
                    </div>
                    <input type="text" id="baumscheibe_makel" name="baumscheibe_makel" placeholder="Beschreibung weitere Makel" class="mt-1">
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_baumscheibe">Erg√§nzungen/Problembeschreibungen</label>
                    <textarea id="ergaenzungen_baumscheibe" name="ergaenzungen_baumscheibe" rows="3"></textarea>
                </div>
            </section>

            <!-- Seite 8: Sch√§den & Krankheiten -->
            <section class="form-section">
                <h2>Schnittwunden, Sch√§den & Krankheiten</h2>
                
                <div class="form-group">
                    <label for="schnittwunden">Anzahl offener Schnittwunden (> 3 cm)</label>
                    <input type="number" id="schnittwunden" name="schnittwunden" min="0" max="100" value="0">
                </div>

                <div class="form-group">
                    <label>Erfassung weiterer Sch√§den und Krankheiten</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="schaeden" value="verbissen"> verbissen (abgeschabte Rinde)</label>
                        <label><input type="checkbox" name="schaeden" value="verfegt"> verfegt (l√§nglich abgeschabte Rinde)</label>
                        <label><input type="checkbox" name="schaeden" value="Rindenschaden durch Pfosten/Verbissschutz"> Rindenschaden durch Pfosten/Verbissschutz</label>
                        <label><input type="checkbox" name="schaeden" value="Rindennekrose"> Rindennekrose (tote Rinde)</label>
                        <label><input type="checkbox" name="schaeden" value="Pilzbefall"> Pilzbefall</label>
                        <label><input type="checkbox" name="schaeden" value="Insektenbohrl√∂cher/-fra√üstellen"> Insektenbohrl√∂cher/-fra√üstellen</label>
                        <label><input type="checkbox" name="schaeden" value="Frostrisse/Sonnenbrand"> Frostrisse/Sonnenbrand</label>
                        <label><input type="checkbox" name="schaeden" value="abgebrochene Spitze"> abgebrochene Spitze</label>
                        <label><input type="checkbox" name="schaeden" value="weitere"> weitere</label>
                    </div>
                    <input type="text" id="schaeden_weitere" name="schaeden_weitere" placeholder="Beschreibung weitere Sch√§den" class="mt-1">
                </div>

                <div class="form-group">
                    <label for="schaeden_beschreibung">Beschreibung der Sch√§den und Krankheiten</label>
                    <textarea id="schaeden_beschreibung" name="schaeden_beschreibung" rows="3" placeholder="z.B. Stamm oder √Ñste betroffen?"></textarea>
                </div>

                <div class="form-group">
                    <label for="ergaenzungen_schaeden">Auff√§lligkeiten & Erg√§nzungen</label>
                    <textarea id="ergaenzungen_schaeden" name="ergaenzungen_schaeden" rows="3" placeholder="z.B. Vogelnest, Sortenschild, Nachpflanzung, untypisches Triebwachstum"></textarea>
                </div>
            </section>

            <!-- Seite 9: Fotodokumentation -->
            <section class="form-section">
                <h2>Fotodokumentation</h2>
                
                <div class="form-group">
                    <label>üì∏ Fotos von Auff√§lligkeiten</label>
                    <div class="photo-info-box">
                        <p><strong>Hinweis zur Fotodokumentation:</strong></p>
                        <p>Bitte fotografiere w√§hrend der Erfassung alle Auff√§lligkeiten am Baum mit deiner Kamera-App.</p>
                        <p>Die Fotos kannst du sp√§ter zusammen mit der exportierten CSV-Datei auf den Server hochladen.</p>
                        <p><em>üí° Tipp: Benenne die Fotos mit der Baum-ID (z.B. "LRO-B-09_1.jpg"), um die Zuordnung zu erleichtern.</em></p>
                    </div>
                </div>
            </section>

            <div class="form-actions">
                <button type="button" id="saveFinishBtn" class="btn btn-primary">‚úì Speichern und abschlie√üen</button>
                <button type="button" id="saveNextTreeBtn" class="btn btn-primary">‚û°Ô∏è Speichern und n√§chsten Baum anlegen</button>
                <button type="button" id="saveNextRowBtn" class="btn btn-primary">‚è© Speichern und n√§chste Reihe anlegen</button>
            </div>
        </form>

        <!-- Help Modals -->
        <div id="helpModal" class="modal">
            <div class="modal-content help-modal-content">
                <span class="close" onclick="closeHelp()">&times;</span>
                <div id="helpContent"></div>
            </div>
        </div>

        <!-- Data Screen -->
        <div id="dataScreen" class="data-screen" style="display:none;">
            <h2>Gespeicherte Baumdaten</h2>
            
            <div class="photo-info-box" style="margin-bottom: 1.5rem; background: #e3f2fd; border-left: 4px solid #2196f3;">
                <p><strong>üíæ Daten√ºbermittlung:</strong></p>
                <p>Exportieren Sie die erfassten Daten als CSV-Datei und laden Sie diese im <strong>Uploadbereich Ihrer Lokalgruppe</strong> hoch. Die Daten k√∂nnen nicht direkt √ºber die App √ºbermittelt werden.</p>
                <p><em>Laden Sie auch Ihre Fotos mit aussagekr√§ftigen Dateinamen (z.B. mit Baum-ID) im gleichen Uploadbereich hoch.</em></p>
            </div>
            
            <div class="data-actions">
                <button id="exportBtn" class="btn btn-secondary">üíæ CSV Export</button>
                <button id="importBtn" class="btn btn-secondary">üì• CSV Import</button>
                <input type="file" id="importFileInput" accept=".csv" style="display:none;">
            </div>
            
            <div id="treeMap" class="tree-map-container">
                <h3>Positionskarte</h3>
                <canvas id="treeMapCanvas"></canvas>
                <div id="mapLegend" class="map-legend"></div>
            </div>
            <div id="dataList"></div>
            <button id="clearAllBtn" class="btn btn-danger">Alle Daten l√∂schen</button>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>